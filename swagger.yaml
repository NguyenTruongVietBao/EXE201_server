openapi: 3.0.3
info:
  title: Server NodeJS API
  description: API cho h·ªá th·ªëng qu·∫£n l√Ω t√†i li·ªáu v√† ng∆∞·ªùi d√πng
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com

servers:
  - url: http://localhost:8080
    description: Development server
  - url: https://exe201-server.onrender.com
    description: Production server

paths:
  # Authentication Endpoints
  /api/auth/register-customer:
    post:
      tags:
        - Authentication
      summary: ƒêƒÉng k√Ω t√†i kho·∫£n kh√°ch h√†ng
      description: T·∫°o t√†i kho·∫£n m·ªõi cho kh√°ch h√†ng
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterCustomerRequest'
      responses:
        '201':
          description: ƒêƒÉng k√Ω th√†nh c√¥ng
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: D·ªØ li·ªáu ƒë·∫ßu v√†o kh√¥ng h·ª£p l·ªá
        '409':
          description: Email ƒë√£ t·ªìn t·∫°i

  /api/auth/register-seller:
    post:
      tags:
        - Authentication
      summary: ƒêƒÉng k√Ω t√†i kho·∫£n ng∆∞·ªùi b√°n
      description: T·∫°o t√†i kho·∫£n m·ªõi cho ng∆∞·ªùi b√°n
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterSellerRequest'
      responses:
        '201':
          description: ƒêƒÉng k√Ω th√†nh c√¥ng
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: D·ªØ li·ªáu ƒë·∫ßu v√†o kh√¥ng h·ª£p l·ªá
        '409':
          description: Email ƒë√£ t·ªìn t·∫°i

  /api/auth/verify-email:
    post:
      tags:
        - Authentication
      summary: X√°c th·ª±c email
      description: X√°c th·ª±c email b·∫±ng token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VerifyEmailRequest'
      responses:
        '200':
          description: X√°c th·ª±c th√†nh c√¥ng
        '400':
          description: Token kh√¥ng h·ª£p l·ªá ho·∫∑c ƒë√£ h·∫øt h·∫°n

  /api/auth/login:
    post:
      tags:
        - Authentication
      summary: ƒêƒÉng nh·∫≠p
      description: ƒêƒÉng nh·∫≠p v√†o h·ªá th·ªëng
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: ƒêƒÉng nh·∫≠p th√†nh c√¥ng
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Th√¥ng tin ƒëƒÉng nh·∫≠p kh√¥ng ch√≠nh x√°c

  # User Endpoints
  /api/users:
    get:
      tags:
        - Users
      summary: L·∫•y danh s√°ch t·∫•t c·∫£ ng∆∞·ªùi d√πng
      description: Tr·∫£ v·ªÅ danh s√°ch t·∫•t c·∫£ ng∆∞·ªùi d√πng trong h·ªá th·ªëng
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Danh s√°ch ng∆∞·ªùi d√πng
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        '401':
          description: Kh√¥ng c√≥ quy·ªÅn truy c·∫≠p

  /api/users/{id}:
    get:
      tags:
        - Users
      summary: L·∫•y th√¥ng tin ng∆∞·ªùi d√πng theo ID
      description: Tr·∫£ v·ªÅ th√¥ng tin chi ti·∫øt c·ªßa m·ªôt ng∆∞·ªùi d√πng
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID c·ªßa ng∆∞·ªùi d√πng
          schema:
            type: string
      responses:
        '200':
          description: Th√¥ng tin ng∆∞·ªùi d√πng
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng
        '401':
          description: Kh√¥ng c√≥ quy·ªÅn truy c·∫≠p

  /api/users/{id}/set-interests:
    put:
      tags:
        - Users
      summary: C·∫≠p nh·∫≠t s·ªü th√≠ch c·ªßa ng∆∞·ªùi d√πng
      description: Thi·∫øt l·∫≠p danh s√°ch s·ªü th√≠ch cho ng∆∞·ªùi d√πng
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID c·ªßa ng∆∞·ªùi d√πng
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SetInterestsRequest'
      responses:
        '200':
          description: C·∫≠p nh·∫≠t s·ªü th√≠ch th√†nh c√¥ng
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng
        '401':
          description: Kh√¥ng c√≥ quy·ªÅn truy c·∫≠p

  /api/users/{id}/update-profile:
    put:
      tags:
        - Users
      summary: C·∫≠p nh·∫≠t th√¥ng tin c√° nh√¢n
      description: C·∫≠p nh·∫≠t th√¥ng tin profile c·ªßa ng∆∞·ªùi d√πng
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID c·ªßa ng∆∞·ªùi d√πng
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProfileRequest'
      responses:
        '200':
          description: C·∫≠p nh·∫≠t th√†nh c√¥ng
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng
        '401':
          description: Kh√¥ng c√≥ quy·ªÅn truy c·∫≠p

  # Interest Endpoints
  /api/interests:
    get:
      tags:
        - Interests
      summary: L·∫•y danh s√°ch s·ªü th√≠ch
      description: Tr·∫£ v·ªÅ danh s√°ch t·∫•t c·∫£ s·ªü th√≠ch c√≥ s·∫µn
      responses:
        '200':
          description: Danh s√°ch s·ªü th√≠ch
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Interest'

    post:
      tags:
        - Interests
      summary: T·∫°o s·ªü th√≠ch m·ªõi
      description: T·∫°o m·ªôt s·ªü th√≠ch m·ªõi trong h·ªá th·ªëng
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateInterestRequest'
      responses:
        '201':
          description: T·∫°o s·ªü th√≠ch th√†nh c√¥ng
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Interest'
        '400':
          description: D·ªØ li·ªáu ƒë·∫ßu v√†o kh√¥ng h·ª£p l·ªá
        '401':
          description: Kh√¥ng c√≥ quy·ªÅn truy c·∫≠p

components:
  schemas:
    # Authentication Schemas
    RegisterCustomerRequest:
      type: object
      required:
        - name
        - email
        - password
        - phone
      properties:
        name:
          type: string
          minLength: 3
          example: 'Nguy·ªÖn VƒÉn A'
        email:
          type: string
          format: email
          example: 'user@example.com'
        password:
          type: string
          minLength: 6
          example: 'password123'
        phone:
          type: string
          pattern: '^[0-9]{10}$'
          example: '0987654321'

    RegisterSellerRequest:
      allOf:
        - $ref: '#/components/schemas/RegisterCustomerRequest'
        - type: object
          properties:
            billingInfo:
              type: string
              example: 'Th√¥ng tin thanh to√°n'
            bankName:
              type: string
              example: 'Vietcombank'
            bankAccountName:
              type: string
              example: 'Nguy·ªÖn VƒÉn A'
            bankAccountNumber:
              type: string
              example: '1234567890'

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: 'user@example.com'
        password:
          type: string
          example: 'password123'

    VerifyEmailRequest:
      type: object
      required:
        - token
      properties:
        token:
          type: string
          example: 'abc123xyz'

    AuthResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: 'ƒêƒÉng nh·∫≠p th√†nh c√¥ng'
        token:
          type: string
          example: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
        user:
          $ref: '#/components/schemas/User'

    # User Schemas
    User:
      type: object
      properties:
        _id:
          type: string
          example: '60d5f7d1f1b2c8b5f8e7a123'
        name:
          type: string
          example: 'Nguy·ªÖn VƒÉn A'
        email:
          type: string
          format: email
          example: 'user@example.com'
        avatar:
          type: string
          example: 'https://api.dicebear.com/9.x/initials/svg?seed=default'
        role:
          type: string
          enum: [CUSTOMER, SELLER, ADMIN, MANAGER]
          example: 'CUSTOMER'
        phone:
          type: string
          example: '0987654321'
        isVerified:
          type: boolean
          example: true
        interests:
          type: array
          items:
            $ref: '#/components/schemas/Interest'
        documents:
          type: array
          items:
            $ref: '#/components/schemas/Document'
        createdAt:
          type: string
          format: date-time
          example: '2023-01-01T00:00:00.000Z'
        updatedAt:
          type: string
          format: date-time
          example: '2023-01-01T00:00:00.000Z'

    SetInterestsRequest:
      type: object
      required:
        - interests
      properties:
        interests:
          type: array
          items:
            type: string
          example: ['60d5f7d1f1b2c8b5f8e7a123', '60d5f7d1f1b2c8b5f8e7a124']

    UpdateProfileRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 3
          example: 'Nguy·ªÖn VƒÉn B'
        phone:
          type: string
          pattern: '^[0-9]{10}$'
          example: '0987654321'
        avatar:
          type: string
          example: 'https://example.com/avatar.jpg'

    # Interest Schemas
    Interest:
      type: object
      properties:
        _id:
          type: string
          example: '60d5f7d1f1b2c8b5f8e7a123'
        name:
          type: string
          example: 'C√¥ng ngh·ªá'
        emoji:
          type: string
          example: 'üíª'

    CreateInterestRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          example: 'C√¥ng ngh·ªá'
        emoji:
          type: string
          example: 'üíª'

    # Document Schema
    Document:
      type: object
      properties:
        _id:
          type: string
          example: '60d5f7d1f1b2c8b5f8e7a123'
        title:
          type: string
          example: 'T√†i li·ªáu h·ªçc t·∫≠p'
        description:
          type: string
          example: 'M√¥ t·∫£ chi ti·∫øt v·ªÅ t√†i li·ªáu'
        category:
          type: string
          example: 'Gi√°o d·ª•c'
        price:
          type: number
          minimum: 0
          example: 100000
        discount:
          type: number
          minimum: 0
          maximum: 100
          example: 10
        imageUrl:
          type: array
          items:
            type: string
          example:
            ['https://example.com/image1.jpg', 'https://example.com/image2.jpg']
        documentUrl:
          type: array
          items:
            type: string
          example:
            ['https://example.com/doc1.pdf', 'https://example.com/doc2.pdf']
        videoUrl:
          type: array
          items:
            type: string
          example: ['https://example.com/video1.mp4']
        isPublic:
          type: boolean
          example: true
        feedback:
          type: array
          items:
            type: object
            properties:
              user:
                type: string
                example: '60d5f7d1f1b2c8b5f8e7a123'
              comment:
                type: string
                example: 'T√†i li·ªáu r·∫•t hay'
              rating:
                type: number
                minimum: 1
                maximum: 5
                example: 5
              createdAt:
                type: string
                format: date-time
                example: '2023-01-01T00:00:00.000Z'
        interest:
          type: array
          items:
            $ref: '#/components/schemas/Interest'
        author:
          $ref: '#/components/schemas/User'
        createdAt:
          type: string
          format: date-time
          example: '2023-01-01T00:00:00.000Z'
        updatedAt:
          type: string
          format: date-time
          example: '2023-01-01T00:00:00.000Z'

    # Error Schemas
    Error:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: 'L·ªói x·∫£y ra'
        error:
          type: string
          example: 'Chi ti·∫øt l·ªói'

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

tags:
  - name: Authentication
    description: C√°c API li√™n quan ƒë·∫øn x√°c th·ª±c
  - name: Users
    description: C√°c API qu·∫£n l√Ω ng∆∞·ªùi d√πng
  - name: Interests
    description: C√°c API qu·∫£n l√Ω s·ªü th√≠ch
